<ActionBar class="action-bar">
  <!-- <NavigationButton ios:visibility="collapsed" icon="res://menu" (tap)="onDrawerButtonTap()"></NavigationButton>
       <ActionItem icon="res://navigation/menu" android:visibility="collapsed" (tap)="onDrawerButtonTap()" ios.position="left"></ActionItem> -->
  <Label class="action-bar-title" text="OTA Update"></Label>
</ActionBar>

<RadSideDrawer #drawer showOverNavigation="true" [drawerTransition]="sideDrawerTransition">

  <StackLayout tkDrawerContent>
    <MyDrawer [selectedPage]="'OTA'"></MyDrawer>
  </StackLayout>

  <ScrollView class="hero" #scrollView tkMainContent>
    <GridLayout columns="*" rows="auto,auto,auto,auto, *" class="page page-content">

      //StackLayout in row 0 contains connectivity buttons for BT
      <StackLayout col="0" row="0" orientation="vertical" verticalAlignment="center" margin="20,0,0,0">
        <StackLayout orientation="horizontal" horizontalAlignment="center" height="75" >
          <Button [class]="connected ? 'fa hero' : 'fa grayed'"
		  text="PushTracker"
		  margin="0, 25, 0, 15"
		  (tap)="onPtButtonTapped()"></Button>
          <Button [class]="connected ? 'fa hero' : 'fa grayed'"
		  text="SmartDrive"
		  margin="0, 25, 0, 15"
		  (tap)="onSdButtonTapped()"></Button>
        </StackLayout>
      </StackLayout>

      //StackLayout in row 1 contains OTA title and descriptions
      <StackLayout   col="0" row="1" orientation="vertical" horizontalAlignment="center" padding="10">

        //OTA Title and version number
        <DockLayout>
          <Label class="title"
		 [text]="ptConnected ? initialTitleText : connectedTitleText"
		 textWrap="true"
		 dock="top"
		 stretchLastChild="true"></Label>
        </DockLayout>

        //OTA Descriptions
        <StackLayout #otaTitleView col="0" row="2" orientation="vertical" horizontalAlignment="center" padding="10">
	  <Label *ngFor="let desc of otaDescription" [text]="desc" class="otaDescription" textWrap="true"></Label>
          <Button class="hero"
		  [text]="updating ? updatingButtonText : initialButtonText"
		  margin="15"
		  (tap)="onStartOtaUpdate()"></Button>
        </StackLayout>
      </StackLayout>

      // TODO: update this to be a list view template which can show
      //       any number of progress bars for any number of updates running

      //StackLayout in row 2 contains progress views for updates
      <StackLayout #otaProgressView col="0" row="3" padding="5" orientation="vertical">
        //SmartDrive OTAs
        <StackLayout *ngFor="let sd of smartDriveOTAs._array">
	  <Label class="title" [text]="'SmartDrive ' + sd.address"></Label>
	  <Label class="title" [text]="sd.otaStateToString()"></Label>
	  // SmartDrive Bluetooth Progress
          <Label class="percentageLabel" [text]="sd.bleOTAProgress +'%'"></Label>
          <Progress [value]="sd.bleOTAProgress" maxValue="100" class="progress"></Progress>
          <Label class="otaLabel" text="SmartDrive Bluetooth"></Label>
          // SmartDrive Microprocessor Progress
          <Label class="percentageLabel" [text]="sd.mcuOTAProgress +'%'"></Label>
          <Progress [value]="sd.mcuOTAProgress" maxValue="100" class="progress"></Progress>
          <Label class="otaLabel" text="SmartDrive Microprocessor"></Label>
	</StackLayout>
        //PushTracker OTAs
        <StackLayout *ngFor="let pt of pushTrackerOTAs._array">
	  <DockLayout class="otaInfo">
            <Label dock="left" class="otaLabel" [text]="pt.otaStateToString()"></Label>
            <Label dock="right" class="percentageLabel" [text]="pt.otaProgress +'%'"></Label>
	  </DockLayout>
          <Progress [value]="pt.otaProgress" maxValue="100" class=" progress"></Progress>
	  <DockLayout class="otaInfo">
            <Label dock="left" class="otaLabel" [text]="'PushTracker ' + pt.address"></Label>
            <Button dock="right" class="otaAction" [text]="pt.otaAction" (tap)="pt.onOTAActionTap()"></Button>
	  </DockLayout>
	</StackLayout>
      </StackLayout>

      //StackLayout in row 3 contains a view to display new features.
      //TODO: Create slideshow and ability to display video and text
      <StackLayout #otaFeaturesView class="featuresLayout" col="0" row="4" padding="5" orientation="vertical">

        <TextView class="features" editable="false" textWrap="true" text="Estimated drive range is a cool new feature in this update. Here's how it works-"></TextView>

      </StackLayout>
    </GridLayout>
  </ScrollView>
</RadSideDrawer>
